<html>

<head>
    <meta charset="UTF-8">
    <title>FUWAFUWA DENTAKU</title>

    <head>

        <style type="text/css">
            .bg_white {
                background-color: #ffffff;
                font-weight: bold;
            }
    
            .bg_on_focus {
                background-color: hsl(51, 100%, 50%);
                font-weight: bold;
            }
    
            body {
                font-size: 60px;
                margin: 0;
                padding: 0;
                background-color: #ffffff;
                color: #000;
            }
    
            a, button, h3, text, div, span, label {
                color: #000 !important;
            }
    
            #rest_button {
                width: 600px;
                height: 100px;
                font-size: 1.6em;
            }
    
            .align_wrap {
                text-align: center;
            }
    
            #subtotal_display {
                background-color: #6633cc;
                color: #ffffff;
            }
    
            .menu-item {
                display: flex;
                align-items: center;
                gap: 20px;
            }
    
            input[type=checkbox] {
                transform: scale(2.5);
                margin-right: 20px;
            }
    
            #ordered_items_header {
                text-align: center;
            }
    
            .warning_area {
                font-size: 85%;
            }
    
            #first_warning {
                color: red;
            }
    
            .table-buttons {
                text-align: center;
                margin-bottom: 20px;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
                width: 100vw;
                padding: 0 5px;
                box-sizing: border-box;
            }
    
            .table-buttons button {
                font-size: 1.5em;
                padding: 10px;
                width: 100%;
                height: 80px;
                cursor: pointer;
                text-align: center;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                display: flex;
                align-items: center;
                justify-content: center;
                box-sizing: border-box;
                background-color: #ffffff;
                border: 2px solid #aaa;
                color: #000;
            }
    
            .table-buttons button.active {
                background-color: #6633cc;
                border-color: #4a2596;
                color: #ffffff;
            }
        </style>

    </head>

    
<body>

    <div　id="menu">

        <text class="warning_area" id="first_warning">
            <!-- 案内文が必要なときはここに。 -->
        </text>
        <text class="warning_area">
            免責事項：自己責任でご使用ください。
        </text>
        <br>

        <div class="table-buttons">
            <button onclick="toggleTable(this, 'A')">A</button>
            <button onclick="toggleTable(this, 'B')">B</button>
            <button onclick="toggleTable(this, '1')">1</button>
            <button onclick="toggleTable(this, '2')">2</button>
            <button onclick="toggleTable(this, '3')">3</button>
            <button onclick="toggleTable(this, '4')">4</button>
            <button onclick="toggleTable(this, '5')">5</button>
            <button onclick="toggleTable(this, '6')">6</button>
            <button onclick="toggleTable(this, '7')">7</button>
            <button onclick="toggleTable(this, '8')">8</button>
            <button onclick="toggleTable(this, '9')">9</button>
            <button onclick="toggleTable(this, 'S1')">S1</button>
            <button onclick="toggleTable(this, 'S2')">S2</button>
            <button onclick="toggleTable(this, 'S3')">S3</button>
            <button onclick="toggleTable(this, 'も')">も</button>
        </div>


        <hr>
        【Lunch】
        <div id="lunch_area"></div>

        <hr>
        【Side Dish】
        <div id="side_dish_area"></div>

        <hr>
        【Classics】
        <div id="classics_area"></div>
        <hr>
        <div id="classics_options_area"></div>

        <hr>
        【Noodle】
        <div id="noodle_soup_ramen_area"></div>
        <div id="noodle_soup_udon_area"></div>
        <div id="noodle_soup_options_area"></div>

        <hr>
        【Dessert】
        <div id="dessert_area"></div>
        <div id="dessert_options_area"></div>

        <hr>
        【Drink】
        <div id="drink_cold_area"></div>
        <div id="drink_hot_area"></div>
        <div id="drink_options_area"></div>
    </div>

    <!-- subtotal display area-->
    <hr>
    <text id=current_item>Last added: </text>
    <br>
    合計額: <text id="subtotal_display">0</text>


    <!--
        <br>
        お釣り： <text id="change_display"></text>

        <br>
        申し出額(チップ込)：
        <input type="number" pattern="\d*" id="sum_asked" onchange="calcChange()" onblur="calcOnBlur(this)"
            onfocus="bgChangeIn(this)">

        <br>
        受取額(チップ込)：
        <input type="number" pattern="\d*" id="sum_received" onchange="calcChange()" onblur="calcOnBlur(this)"
            onfocus="bgChangeIn(this)">
        -->

    <hr>
    <div class="align_wrap">
        <button id="rest_button" onclick="reset()">CLEAR</button>
    </div>

    <hr style="height: 5px; background-color: #000; border: none;">
    <h3 id="instruction_header" style="text-align: center;">Kitchen Instruction Slip</h3>
    <div id="selected_table"
        style="border: 2px solid #aaa; padding: 5px; text-align: center; width: 33%; min-height: 40px; margin: 0 auto; font-size: 1.5em;">
    </div>

    <h3 id="ordered_items_header">
        オーダー数/ORDERED: <text id="num_items_display">0</text>
    </h3>
    <div style="color: red; font-weight:bold">
        <!--
            オーダーカードと数の突き合わせをすること！
            MATCH THE NUMBER ON THE ORDER CARD!
            -->
    </div>

    <ul type="disc" id="order_list_display_area"></ul>
    <br>


    <!-- TODO: 子クラスとか作れるんかなあ？SideDishesクラスの小クラスのedamameとか-->

    <script language="javascript" type="text/javascript">

        function checkNumber(obj) {
            const str = obj.value;
            if (str.match(/[^0-9]/g)) {
                alert("半角数値以外が入力されています");
            }
        }


        //todo: CSSもやる気なく適応。もはや玉虫色。
        function bgChangeIn(obj) {
            obj.className = "bg_on_focus";
        }


        function bgChangeOut(obj) {
            obj.className = "bg_white";
        }


        function calcOnBlur(elem) {
            bgChangeOut(elem);
            calcChange();
        }


        //reset. clear all selection and calculation result
        function reset() {
            let checkbox = document.querySelectorAll('input[type="checkbox"]');
            let input = document.querySelectorAll('input[type="number"]');
            const orderListDisplayArea = document.querySelector("#order_list_display_area");


            checkbox.forEach(elem => elem.checked = false);
            input.forEach(elem => elem.value = "");
            orderListDisplayArea.innerHTML = null;

            // clear food items
            //attn: A = []; will set new empty array. but the original array will remain unchanged!
            foodItems.length = 0;

            currentItemDisplay.innerText = "";
            subtotalDisplay.innerText = "0";
            document.querySelector("#change_display").innerText = ""; //統一感がないが直すやる気なし。
        }


        function calcChange() {
            const sumAsked = document.querySelector("#sum_asked");
            const sumReceived = document.querySelector("#sum_received");
            let changeDisplay = document.querySelector("#change_display");

            if (!(sumAsked.value === "") && (Number(sumAsked.value) < Number(subtotalDisplay.innerText))) {
                changeDisplay.innerText = "エラー❗お客さんの申し出額が飲食合計額を下回っている！";
            }

            else if (!(sumReceived.value === "") && (Number(sumReceived.value) < Number(subtotalDisplay.innerText))) {
                changeDisplay.innerText = "エラー❗お客さんからの受取額が飲食合計額を下回っている！！";
            }

            else if (!(sumAsked.value === "") && !(sumReceived.value === "")) {
                //好奇心でNumber()を使用している
                const change = Number(sumReceived.value) - Number(sumAsked.value);
                changeDisplay.innerText = (change < 0) ? "エラー❗受取額は申し出額より多くなければならない！！" : change;
            }
        }


        //商品メニュー
        const price = {}

        const menuItems = {
            "classics": {
                "Okonomi Beef": 13.9,
                "Okonomi Bonito": 13.9,
                "Okonomi Vegetarian": 12.9,
                "Okonomi Vegan": 11.9,
                "Curry Beef": 12.9,
                "Curry Chicken": 12.9,
                "Curry Vegetarian": 11.9,
                "Curry Vegan": 10.9,
                "Gyudon": 13.9
            },
            "classicsOptions": {
                "+Okonomi Hiroshima Noodles": 2,
                "+Okonomi Bonito": 0.5,
                "+Okonomi Dead Spicy": 0.5,
                "+Curry Dead Spicy": 0.5,
                "+Gyudon Dead Spicy": 0.5,
            },
            "lunch": {
                "Lunch Vegan Tofu Soup": 6.9,
                "Lunch Chicken Soup": 8.9,
                "Lunch Beef Soup": 9.9,
                "Gyoza Soup": 9.9,
                "Vegan Gyoza Soup": 9.9
            },
            "noodleSoupRamen": {
                "Ramen Miso": 12.9,
                "Ramen Creamy": 13.5,
                "Ramen Spicy": 13.5,
                "Ramen Sesame": 13.5,
                "Ramen Angry Ramen": 13.9
            },
            "noodleSoupUdon": {
            "Udon Kitsune": 12.9,
            "Udon Kakiage": 13.9,
            "Udon Niku": 13.9,
            "Udon Curry": 13.9,
            "Udon Sesame": 13.9,
            "Udon EbiTempura": 14.9
        },
            "noodleSoupOptions": {
                "+Ramen Egg": 1,
                "+Ramen Dead Spicy": 0.5,
                "+Udon Poached Egg": 1,
                "+Udon Dead Spicy": 0.5,
            },
            "sideDish": {
                "Edamame": 4.5,
                "Kimchi": 4.5,
                "Wakame": 4.5,
                "Nikuman": 5.5,
                "Kakiage": 5.5,
                "Gyoza": 5.9,
                "Vegan Gyoza": 5.9,
                "Karaage": 6.3,
                "Ebi Tempura": 6.9,
                "Takoyaki": 6.9,
                "Onigiri": 4.3
            },
            "dessert": {
                "Ice Cream": 2,
                "Mochi/Dango/Taiyaki": 4.2,
                "Dorayaki/Melonpan": 4.6,
                "Crêpe": 7.9,
                "Honey Toast": 9.9,
                "Parfait": 7.9,
                "Sweets Set": 10.9
            },
            "dessertOptions": {
                "+Strawberry": 1,
                "+Ice cream": 1.5
            },
            "drinkCold": {
                "Float Drink": 6.9,
                "Creamy Iced Latte": 6.5,
                "Bubble Tea": 5.2,
                "Cola/Zero/Water": 3.9,
                "Ramune/Erdinger": 4.2,
                "Eistee": 4.9,
                "Soda": 4.7,
            },
            "drinkHot": {
                "Hot Tea": 4.3,
                "Hot Latte": 5.7,
                "Hot Caffè Latte": 4.5,
                "Americano": 4.0
            },
            "drinkOptions": {
                "+Drink-Hafer": 0.5
            }
        };

        Object.values(menuItems).forEach(item => Object.assign(price, item));

        function addFoodItem(area, priceList) {
            for (let [key, value] of Object.entries(priceList)) {
                const container = document.createElement("div");
                container.classList.add("menu-item");

                const food = document.createElement("input");
                food.setAttribute("type", "checkbox");
                food.setAttribute("onclick", "onTap(this)");
                food.setAttribute("id", key);

                const label = document.createElement("label");
                label.setAttribute("for", key);
                label.innerHTML = `${key} ${value}`;

                container.appendChild(food);
                container.appendChild(label);
                area.appendChild(container);
            }
        }


        addFoodItem(document.querySelector("#classics_area"), menuItems.classics);
        addFoodItem(document.querySelector("#classics_options_area"), menuItems.classicsOptions);
        addFoodItem(document.querySelector("#lunch_area"), menuItems.lunch);
        addFoodItem(document.querySelector("#noodle_soup_ramen_area"), menuItems.noodleSoupRamen);
        addFoodItem(document.querySelector("#noodle_soup_udon_area"), menuItems.noodleSoupUdon);
        addFoodItem(document.querySelector("#noodle_soup_options_area"), menuItems.noodleSoupOptions);
        addFoodItem(document.querySelector("#side_dish_area"), menuItems.sideDish);
        addFoodItem(document.querySelector("#dessert_area"), menuItems.dessert);
        addFoodItem(document.querySelector("#dessert_options_area"), menuItems.dessertOptions);
        addFoodItem(document.querySelector("#drink_cold_area"), menuItems.drinkCold);
        addFoodItem(document.querySelector("#drink_hot_area"), menuItems.drinkHot);
        addFoodItem(document.querySelector("#drink_options_area"), menuItems.drinkOptions);


        // food item classes and factory
        class FoodItem {
            constructor(name, price) {
                //this.id = id;
                this.name = name;
                this.price = price;
            }
        }


        class SideDishes extends FoodItem {
        }


        class FoodItemFactory {
            make(foodItemName) {
                return new FoodItem(foodItemName, price[foodItemName]);
            }
        }


        //create factory instance
        const foodItemFactory = new FoodItemFactory();


        //subtotal area
        let currentItemDisplay = document.querySelector("#current_item");
        let subtotalDisplay = document.querySelector("#subtotal_display");
        const numItemsDisplay = document.querySelector("#num_items_display");


        // calculation
        let foodItems = new Array();

        function onTap(elem) {
            console.log(elem);

            const itemName = elem.id
            const itemPrice = price[itemName];

            if (elem.checked) {
                //create food item
                const foodItem = foodItemFactory.make(itemName);
                console.log(foodItem);
                foodItems.push(foodItem);

                // show in subtotal display area
                currentItemDisplay.innerText = "Last added: " + foodItem.name + ":" + foodItem.price;
                redrawSubtotalDisplay(foodItems);
                reRenderNumItmDisplay(foodItems);

                //renew display
                redrawOrderListDisplay(foodItems);

                //debug
                console.log(foodItems);

            } else {
                //delete item
                foodItems = foodItems.filter(elem => elem.name !== itemName);

                //calc sum
                const totalPrice = calcSum(foodItems); //ここでも上と統一感なし。まあええわ。
                subtotalDisplay.innerText = totalPrice.toFixed(2);
                currentItemDisplay.innerText = "";

                //number of items 
                reRenderNumItmDisplay(foodItems);

                //redraw display
                redrawOrderListDisplay(foodItems);

                //debug
                console.log("totalPrice: " + totalPrice.toFixed(2));
                console.log(foodItems);
            }
        }


        function duplicateItem(item) {
            // received item
            const itemName = item.firstElementChild.firstElementChild.innerText;

            //debug
            console.log(itemName);

            //create food item
            const foodItem = foodItemFactory.make(itemName);
            console.log(foodItem);
            foodItems.push(foodItem);

            // redraw in subtotal display area
            currentItemDisplay.innerText = "Last added: " + foodItem.name + ":" + foodItem.price;
            redrawSubtotalDisplay(foodItems);
            reRenderNumItmDisplay(foodItems);

            //redraw display
            redrawOrderListDisplay(foodItems);

            //debug
            console.log(foodItems);
        }


        function calcSum(foodItems) {
            return foodItems.reduce((sum, elem) => sum + elem.price, 0);
        }


        function redrawSubtotalDisplay(foodItems) {
            const totalPrice = calcSum(foodItems);
            subtotalDisplay.innerText = totalPrice.toFixed(2);

            //debug
            console.log("totalPrice: " + totalPrice.toFixed(2));
        }

        function reRenderNumItmDisplay(foodItems) {
            // const totalPrice = calcSum(foodItems);
            // numItemsDisplay.innerHTML = null;
            console.log("foodItems.length:", foodItems.length)
            numItemsDisplay.innerText = foodItems.length;
        }


        function redrawOrderListDisplay(foodItems) {

            const orderListDisplayArea = document.querySelector("#order_list_display_area");
            // const numItemsDisplay = document.querySelector("#num_items_display");

            //clear
            orderListDisplayArea.innerHTML = null;
            // numItemsDisplay.innerHTML = null;

            // show list
            foodItems.forEach(elem => {
                const foodItemName = document.createElement("text");
                foodItemName.innerText = elem.name;

                const foodItemPrice = document.createElement("text");
                foodItemPrice.innerText = ": " + elem.price;

                const divInFoodItem = document.createElement("div");
                divInFoodItem.appendChild(foodItemName);
                divInFoodItem.appendChild(foodItemPrice);

                const foodItem = document.createElement("li");
                foodItem.setAttribute("onclick", "duplicateItem(this)");
                foodItem.appendChild(divInFoodItem);

                orderListDisplayArea.appendChild(foodItem);
            });
        }

        function toggleTable(button, table) {
            let buttons = document.querySelectorAll(".table-buttons button");
            buttons.forEach(btn => btn.classList.remove("active"));
            button.classList.add("active");
            document.getElementById("selected_table").innerText = table;
        }


    </script>

</body>

</html>